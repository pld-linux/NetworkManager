--- NetworkManager-0.9.1.90/configure.ac.orig	2011-10-15 01:01:08.796289042 +0200
+++ NetworkManager-0.9.1.90/configure.ac	2011-10-15 01:36:15.323576404 +0200
@@ -321,29 +321,30 @@ AC_DEFINE_UNQUOTED(NO_CONSOLEKIT, $no_ck
 
 have_libnl="no"
 PKG_CHECK_MODULES(LIBNL1, libnl-1 >= 1.0-pre8, [have_libnl1=yes], [have_libnl1=no])
-if (test "${have_libnl1}" = "yes"); then
-	AC_DEFINE(HAVE_LIBNL1, 1, [Define if you require libnl-1 legacy support])
-	LIBNL_CFLAGS="$LIBNL1_CFLAGS"
-	LIBNL_LIBS="$LIBNL1_LIBS"
-	libnl_version="1"
+PKG_CHECK_MODULES(LIBNL2, libnl-2.0, [have_libnl2=yes], [have_libnl2=no])
+PKG_CHECK_MODULES(LIBNL3, libnl-3.0 libnl-route-3.0, [have_libnl3=yes], [have_libnl3=no])
+if (test "${have_libnl3}" = "yes"); then
+	AC_DEFINE(HAVE_LIBNL3, 1, [Define if you require specific libnl-3 support])
+	LIBNL_CFLAGS="$LIBNL3_CFLAGS"
+	LIBNL_LIBS="$LIBNL3_LIBS"
+	libnl_version="3"
 	have_libnl="yes"
+	have_libnl2="no"
+	have_libnl1="no"
 fi
-
-PKG_CHECK_MODULES(LIBNL2, libnl-2.0, [have_libnl2=yes], [have_libnl2=no])
 if (test "${have_libnl2}" = "yes"); then
 	AC_DEFINE(HAVE_LIBNL2, 1, [Define if you require specific libnl-2 support])
 	LIBNL_CFLAGS="$LIBNL2_CFLAGS"
 	LIBNL_LIBS="$LIBNL2_LIBS"
 	libnl_version="2"
 	have_libnl="yes"
+	have_libnl1="no"
 fi
-
-PKG_CHECK_MODULES(LIBNL3, libnl-3.0 libnl-route-3.0, [have_libnl3=yes], [have_libnl3=no])
-if (test "${have_libnl3}" = "yes"); then
-	AC_DEFINE(HAVE_LIBNL3, 1, [Define if you require specific libnl-3 support])
-	LIBNL_CFLAGS="$LIBNL3_CFLAGS"
-	LIBNL_LIBS="$LIBNL3_LIBS"
-	libnl_version="3"
+if (test "${have_libnl1}" = "yes"); then
+	AC_DEFINE(HAVE_LIBNL1, 1, [Define if you require libnl-1 legacy support])
+	LIBNL_CFLAGS="$LIBNL1_CFLAGS"
+	LIBNL_LIBS="$LIBNL1_LIBS"
+	libnl_version="1"
 	have_libnl="yes"
 fi
 
